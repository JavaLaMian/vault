<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>
    <meta charset="utf-8">
    <title>欢迎来到小母牛理财</title>
    <script th:src="@{/js/jquery-1.12.4.js}"></script>
    <link th:href="@{/css/userlogin.css}" rel="stylesheet">
</head>
<body id="bod">
<div class="logbao">
    <div id="new">
        <div id="news" style="height: 100%;display: none;">
            <div class="tiancon2"></div>
            <div style="width: 70%;height: 40%;margin: 0 auto;padding: 8% 0 12% 0;background-color: #cccccc80;border-radius: 10px;">
                <h2 style="font-size: 30px;font-family: 宋体;margin: 0;text-align: center;">注册一个账户</h2>
                <form th:action="@{/user/add}" method="post">
                    <div style="width: 90%;height: 30px;margin: 30px auto;">
                        <p class="pxian">邮箱</p>
                        <input class="kuang" id="zcEmail" name="email" oninput="zzsru(this)" onblur="yanEmail(this,'zc')" type="text"/>
                    </div>
                    <div style="width: 90%;height: 30px;margin: 30px auto;">
                        <p class="pxian">密码</p>
                        <input class="kuang" id="pwd2" oninput="abc_123(this)" type="password"/>
                    </div>
                    <div style="width: 90%;height: 30px;margin: 30px auto;">
                        <p class="pxian" style="font-size: 13px">确认密码</p>
                        <input class="kuang" id="pwd" name="loginPsw" onblur="yanPwd(this)" type="password"/>
                    </div>
                    <div style="width: 90%;margin:0 auto;height: 30px;transition: 0.5s;margin-bottom:30px">
                        <input class="mkuang" id="zcYam" type="text"/>
                        <input class="cxMa" type="button" style="height:33px;border: 1px #ccc solid;padding: 0 5px;" onclick="getMa('zc',this)" value="获取" />
                        <input class="mkuang" id="yaoqing" name="refereer" placeholder="邀请人账号" style="width:0;float: right;margin-right:2%" type="text"/>
                    </div>
                    <div style="width: 90%;height: 30px;margin: 0 auto;">
                        <input value="登陆" class="loginzy" type="button" onclick="logNew(1)"/>
                        <input value="注册" id="goNew" class="daanniu" type="submit" onclick="return newZhang()"/>
                        <input value="有邀请人" class="loginzy" onclick="yaoQing(this)" type="button"/>
                    </div>
                </form>
            </div>
            <div class="tiancon2"></div>
        </div>
    </div>
    <div id="imgs" style="background-image: url(/img/loan/loginBg.jpg);">
    </div>
    <div id="login">
        <div id="logins" style="height: 100%;">
            <div class="tiancon"></div>
            <div style="width: 70%;height: 35%;margin: 0 auto;padding: 5% 0;background-color: #cccccc80;border-radius: 10px;">
                <h2 style="font-size: 30px;font-family: 宋体;text-align: center;">登陆</h2>
                <form th:action="@{/user/login}" method="post">
                    <input name="logtype" type="hidden" id="logtype" value="0">
                    <div style="width: 90%;height: 30px;margin: 30px auto;">
                        <select class="xiala" onchange="pwdEmail(this)">
                            <option value="zh">账号</option>
                            <option value="yx">邮箱</option>
                        </select>
                        <input class="kuang" name="account" id="zhanghao" placeholder="也可以是邮箱" style="display: block" type="text"/>
                        <input class="kuang" name="email" id="dlEmail" style="display: none" oninput="zzsru(this)" onblur="yanEmail(this,'dl')" type="text"/>
                    </div>
                    <div id="pwdYz" style="width: 90%;height: 30px;margin: 30px auto;transition: 0.5s;">
                        <select class="xiala" onchange="pwdLookF(this)">
                            <option value="mm">密码</option>
                            <option value="xs">显示</option>
                        </select>
                        <input class="kuang" id="pwdyc" name="pwd" placeholder="区分大小写" oninput="tonBu('yc')" type="password"/>
                        <input id="pwdLook" class="kuang" type="text" oninput="tonBu('lk')" style="display: none"/>
                    </div>
                    <div id="emailYz" style="width: 90%;margin:0 auto;height: 0px;transition: 0.5s;">
                        <input class="mkuang" id="dlmaKun" type="text"/>
                        <input class="cxMa" type="button" onclick="getMa('dl',this)" value="获取" />
                    </div>
                    <div style="width: 90%;height: 30px;margin: 0 auto;">
                        <input value="注册" class="loginzy" type="button" onclick="logNew(0)"/>
                        <input value="登陆" id="gologin" class="daanniu" type="submit" onclick="return loginUser()"/>
                        <a class="loginzy" type="button" style="padding: 5px;font-size: 14px;color: black;text-decoration: none;" target="_blank" th:href="@{/user/tozhao}"/>忘记密码</a>
                    </div>
                </form>
                <p class="logmsg" style="text-align: center;color: yellow" th:if="${msg!='' || msg != null}"
                 th:text="${msg}"></p>
            </div>
            <div class="tiancon"></div>
        </div>
    </div>
</div>
</body>
<script>
    function chuangKou(){
        var kuan = window.outerWidth; //获取当前浏览器的宽度
        var gao =  $(window).height();

        if(kuan <= 1450){
            var top = (gao - 800)/2;
            if(kuan <= 400){
                $(".logbao").css("top",top+"px");
                $(".logbao").css("width","100%");
                $(".logbao").css("left","0");
            }else{
                $(".logbao").css("width","500px");
                var left = (kuan - 500)/2;
            }

            $("#imgs").css("display","none");
            $(".logbao").css("top",top+"px");
            $(".logbao").css("left",left+"px");

            $("#bod").css("background-position","100% 0")
        }else{
            var top = (gao - 800)/2;
            var left = (kuan - 1500)/2;
            $("#imgs").css("display","block");
            $(".logbao").css("width","1500px");
            $(".logbao").css("top",top+"px");
            $(".logbao").css("left",left+"px");
        }
    }
    chuangKou();

    window.onresize = function(){
        chuangKou();
    };

    function zzsru(id){
        var value = $(id).val();
        var tian = "";
        for(var j = 0;j < value.length; j++){
            var vnm = value.charAt(j);
            var ascl = vnm.charCodeAt();
            if(ascl === 46 || (ascl >= 48 && ascl <= 57) || (ascl >= 64 && ascl <= 90)|| (ascl >= 97 && ascl <= 122)){
                tian += vnm;
            }else{
                errorShuru(id);
            }
        }
        $(id).val(tian);
    }

    function getParam() {

        var url = location.search; //获取url中"?"符后的字串

        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            if(str === 'zc'){
                logNew(0);
            }
        }
    }
    getParam();

    var getMapad = 0;
    var getMaDl = 0;
    function yanEmail(id,type){
        var reg = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //正则表达式
        if($(id).val() !== ""){ //输入不能为空
            if(!reg.test($(id).val())){ //正则验证不通过，格式不对
                getMapad = 0;
                getMaDl = 0;
                errorShuru(id);
            }else {
                if(type === "zc"){
                    $.post("/user/padEmail",{email:$(id).val()},function (data) {//判断邮箱是否被注册
                        if(data){
                            getMaDl = 0;
                            errorShuru(id);
                        }else {
                            getMapad = 1;
                        }
                    },"json");
                }
                if(type === "dl"){ //判断邮箱是否存在
                    $.post("/user/padEmail",{email:$(id).val()},function (data) {
                        if(data){
                            getMaDl = 1;
                        }else {
                            getMaDl = 0;
                            errorShuru(id);
                        }
                    },"json");
                }

            }
        }
    }

    function yanPwd() { //验证两次密码是否一致
        if($("#pwd").val() !== $("#pwd2").val()){
            errorShuru($("#pwd"));
        }
    }

    function abc_123(id){
        var value = $(id).val();
        var tian = "";
        for(var j = 0;j < value.length; j++){
            var vnm = value.charAt(j);
            var ascl = vnm.charCodeAt();
            if(ascl >= 33 && ascl <= 126){
                tian += vnm;
            }else{
                errorShuru(id);
            }
        }
        $(id).val(tian);
    }

    var idd;
    var errorJishi = null;
    function errorShuru(id){
        idd = id;
        if(errorJishi == null){
            errorJishi = setInterval("huxiColor()", "1");
        }
    }

    var tis = 255;
    var tis2 = 0;
    function huxiColor() { /*出错变色*/
        if(tis >=0 ){
            tis -= 1;
            $(idd).css("background-color", "rgb(255,"+tis+","+tis+")");
            if (tis === 0) tis = -1;
        }else{
            tis2 += 1;
            $(idd).css("background-color", "rgb(255,"+tis2+","+tis2+")");
            if(tis2 === 255){
                clearInterval(errorJishi);
                errorJishi = null;
                tis = 255;
                tis2 = 0;
                idd = null;
            }
        }
    }

    var loginDong;
    var newDong;
    $("#gologin").mouseover(function(){
        loginDong = setInterval("dontai()", "10");
    });

    $(".logmsg").mouseover(function(){
        $(".logmsg").css("display","none");
    });

    $("#gologin").mouseleave(function(){
        clearInterval(loginDong);
    });

    $("#zcYam").click(function(){
        $("#zcYam").css("background-color","white");
    });
    $("#dlmaKun").click(function(){
        $("#dlmaKun").css("background-color","white");
    });

    function yaoQing(id){
        if($(id).val() == "有邀请人"){
            $("#yaoqing").css("width","46%");
            $("#yaoqing").css("height","25px");
            $("#yaoqing").css("border","1px #ccc solid");
            $("#yaoqing").css("border-left","0");
            $("#yaoqing").css("padding","3px 5px");

            $("#zcYam").css("width","20.5%");
            $(id).val("取消");
        }else{
            $("#yaoqing").css("width","0");
            $("#yaoqing").css("height","0");
            $("#yaoqing").css("border","0");
            $("#yaoqing").css("padding","0");

            $("#zcYam").css("width","72.5%");
            $(id).val("有邀请人");
        }
    }

    var loginType = 0;
    function pwdEmail(id){
        var vs = $(id).val();
        if(vs == 'zh'){
            loginType = 0;
            $("#logtype").val('0');
            $("#zhanghao").css("display","block");
            $("#dlEmail").css("display","none");

            $("#emailYz input").css("height","0");
            $("#emailYz input").css("padding","0");
            $("#emailYz input").css("border","0");
            $("#emailYz input").css("height","0");

            $("#emailYz").css("height","0");
            $("#emailYz").css("margin-bottom","0");

            $("#pwdYz").css("height","30px");
            $("#pwdYz").css("margin","30px auto");

            $("#pwdYz .kuang").css("height","25px");
            $("#pwdYz .kuang").css("padding","3px 7px 3px 8px");
            $("#pwdYz .kuang").css("border","1px #ccc solid");

            $("#pwdYz .xiala").css("height","33px");
            $("#pwdYz .xiala").css("padding-left","5px");
            $("#pwdYz .xiala").css("border","1px #ccc solid");
            $("#pwdYz .xiala").css("border-right","0");
        }else{
            loginType = 1;
            $("#logtype").val('1');
            $("#zhanghao").css("display","none");
            $("#dlEmail").css("display","block");

            $("#emailYz").css("height","33px");
            $("#emailYz").css("margin","0 auto");
            $("#emailYz").css("margin-bottom","30px");

            $("#dlmaKun").css("height","25px");
            $("#dlmaKun").css("padding","3px 7px 3px 8px");
            $("#dlmaKun").css("border","1px #ccc solid");
            $("#dlmaKun").css("border-right","0");

            $("#emailYz .cxMa").css("height","33px");
            $("#emailYz .cxMa").css("border","1px #ccc solid");
            $("#emailYz .cxMa").css("padding","0 5px");

            $("#pwdYz").css("height","0");
            $("#pwdYz").css("margin","0");

            $("#pwdYz .kuang").css("height","0");
            $("#pwdYz .kuang").css("padding","0");
            $("#pwdYz .kuang").css("border","0");

            $("#pwdYz .xiala").css("height","0");
            $("#pwdYz .xiala").css("padding","0");
            $("#pwdYz .xiala").css("border","0");
        }
    }

    var pwdlook = 0;
    function pwdLookF(id) {
        var vs = $(id).val();
        if(vs === 'xs'){
            pwdlook = 1;
            $("#pwdLook").css("display","block");
            $("#pwdyc").css("display","none");
        }else {
            pwdlook = 0;
            $("#pwdyc").css("display","block");
            $("#pwdLook").css("display","none");
        }
    }

    function tonBu(ty) {
        if(ty === "yc"){
            $("#pwdLook").val($("#pwdyc").val());
        }else {
            $("#pwdyc").val($("#pwdLook").val());
        }
    }

    var jishi = 59;
    var jishuTishi;
    var zcMa = 0;
    var dlMa = 0;
    function getMa(type,id){
        if((getMapad !== 0 && type === "zc")||(getMaDl !== 0 && type === "dl")){
            if($(id).val() === "获取" ||$(id).val() === "取得"){
                $(id).val('获取(59)');
                $(id).css("background-color","white");
                jishuTishi  = setInterval("daojishi()", "1000");

                var email = "";
                if(type === "zc") email = $("#zcEmail").val();
                else email = $("#dlEmail").val();
                $.post("/user/getMa",{email:email,type:type},function (data) {
                    if(data === "" || data == null){
                        if(type === "zc") errorShuru($("#zcEmail"));
                        else errorShuru($("#dlEmail"));

                        alert("请检查邮箱格式是否正确");
                    }else {
                        if(type === "zc")zcMa = data;
                        if(type === "dl")dlMa = data;
                    }
                },"json");
            }else{
                //已经在获取验证码
            }
        }else {
            if(type === "zc")errorShuru($("#zcEmail"));
            if(type === "dl")errorShuru($("#dlEmail"));
        }
    }
    function daojishi(){
        jishi -= 1;
        if(jishi === 0){
            jishi = 59;
            clearInterval(jishuTishi);
            $(".cxMa").val('获取');
            $(".cxMa").css("background-color","#FF7F50");
        }else{
            $(".cxMa").val("获取("+jishi+")");
        }
    }

    function newZhang(){
        var yunma = zcMa+"";
        var shuru = $("#zcYam").val()+"";
        if($("#zcEmail").val() === ""){
            errorShuru($("#zcEmail"));
            return false;
        }else if($("#pwd").val() === ""){
            errorShuru($("#pwd"));
            return false;
        }else if($("#pwd").val() !== $("#pwd2").val()){
            errorShuru($("#pwd2"));
            return false;
        }else if(yunma !== shuru || zcMa === 0){
            $("#zcYam").css("background-color","red");
            return false;
        }else {
            return true;
        }
    }

    function loginUser() {
        var yunma = dlMa+"";
        var shuru = $("#dlmaKun").val()+"";
        if(loginType === 0){//密码验证
            if($("#zhanghao").val() === ''){
                errorShuru($("#zhanghao"));
                return false;
            }else if($("#pwdyc").val() === ''){
                if(pwdlook === 0)errorShuru($("#pwdyc"));
                else errorShuru($("#pwdLook"));
                return false;
            }else {
                return true;
            }
        }else if(loginType === 1){
            if($("#dlEmail").val() === ''){
                errorShuru($("#dlEmail"));
                return false;
            }else if(shuru === '' || shuru !== yunma || shuru === '0'){
                $("#dlmaKun").css("background-color","red");
                return false;
            }else if(yunma === shuru){
                return true;
            }
        }
    }

    function logNew(type){
        if(type == 1){//登陆
            $("#login").css("width","500px");
            $("#imgs").css("left","0");
            $("#new").css("width","0");
            bianBg('right');
            setTimeout("changNei(1);",250);
            clearInterval(newDong);
        }else{
            newDong = setInterval("dontai2()", "10");
            $("#login").css("width","0");
            $("#imgs").css("left","500px");
            $("#new").css("width","500px");
            bianBg('left');
            setTimeout("changNei(0);",250)
        }
    }

    function bianBg(type){
        var kuan = window.outerWidth; //获取当前浏览器的宽度
        if(type === 'left'){
            var text = "";
            if(kuan <= 1450) text = "0 0";
            else text = "0 50%";
            document.getElementById("bod").style.backgroundPosition=text;
        }else if(type === 'center'){
            document.getElementById("bod").style.backgroundPosition="50% 50%";
        }else{
            var text = "";
            if(kuan <= 1450) text = "100% 0";
            else text = "100% 50%";
            document.getElementById("bod").style.backgroundPosition=text;
        }
    }

    function changNei(type){
        if(type === 1){//登陆
            $("#news").css("display","none");
            $("#logins").css("display","block");
        }else{
            $("#logins").css("display","none");
            $("#news").css("display","block");
        }
    }

    var zuo = 50;
    var zt = 0;
    function dontai(){
        if(zt === 0){
            zuo -= 1;
            document.getElementById("gologin").style.backgroundPosition=zuo+"% 50%";
            if(zuo === 0) zt = 1;
        }else if(zt === 1){
            zuo += 1;
            document.getElementById("gologin").style.backgroundPosition=zuo+"% 50%";

            if(zuo === 100) zt = 0;
        }
    }
    var zuo2 = 50;
    var zt2 = 0;
    function dontai2(){
        if(zt2 === 0){
            zuo2 -= 1;
            document.getElementById("goNew").style.backgroundPosition=zuo2+"% 50%";
            if(zuo2 === 0) zt2 = 1;
        }else if(zt2 === 1){
            zuo2 += 1;
            document.getElementById("goNew").style.backgroundPosition=zuo2+"% 50%";
            if(zuo2 === 100) zt2 = 0;
        }
    }
</script>
</html>